<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin - MultiRestaurante</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',sans-serif; }
        body { background:#f5f7fa; }
        .navbar { background:white; padding:15px 30px; box-shadow:0 2px 10px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
        .logo h1 span { color:#667eea; }
        .logout-btn { background:#dc3545; color:white; padding:8px 16px; border-radius:5px; text-decoration:none; }
        .container { padding:30px; max-width:1200px; margin:0 auto; }
        .page-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; }
        .btn-primary { background:#28a745; color:white; padding:12px 24px; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
        .btn-primary:hover { background:#218838; }
        .table-container { background:white; border-radius:15px; overflow:hidden; box-shadow:0 5px 15px rgba(0,0,0,0.05); }
        table { width:100%; border-collapse:collapse; }
        th { background:#667eea; color:white; padding:15px; text-align:left; }
        td { padding:15px; border-bottom:1px solid #eee; }
        .btn-sm { background:#667eea; color:white; padding:6px 12px; border:none; border-radius:5px; text-decoration:none; }
        .btn-sm-danger { background:#dc3545; }
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1000; }
        .modal.active { display:flex; }
        .modal-content { background:white; border-radius:15px; padding:30px; width:90%; max-width:500px; max-height:90vh; overflow-y:auto; }
        .modal-content h2 { margin-bottom:20px; }
        .modal-content h3 { margin:20px 0 10px; color:#555; }
        .form-group { margin-bottom:15px; }
        label { display:block; margin-bottom:5px; color:#555; font-weight:500; }
        input { width:100%; padding:10px; border:2px solid #e1e1e1; border-radius:8px; }
        .modal-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:20px; }
        .loading, .empty { text-align:center; padding:40px; color:#999; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo"><h1>üëë <span>Super Admin</span> | MultiRestaurante</h1></div>
        <a href="/logout" class="logout-btn">Sair</a>
    </nav>

    <div class="container">
        <div class="page-header">
            <h2>üè¢ Restaurantes Cadastrados</h2>
            <button class="btn-primary" onclick="abrirModal()">+ Novo Restaurante</button>
        </div>
        <div class="table-container">
            <table>
                <thead><tr><th>ID</th><th>Nome</th><th>Email</th><th>Telefone</th><th>A√ß√µes</th></tr></thead>
                <tbody id="restaurantes-list"><tr><td colspan="5" class="loading">Carregando...</td></tr></tbody>
            </table>
        </div>
    </div>

    <div class="modal" id="modal-restaurante">
        <div class="modal-content">
            <h2>‚ûï Novo Restaurante</h2>
            <h3>Dados do Restaurante</h3>
            <div class="form-group"><label>Nome</label><input type="text" id="rest-nome" required></div>
            <div class="form-group"><label>Email</label><input type="email" id="rest-email" required></div>
            <div class="form-group"><label>Telefone</label><input type="text" id="rest-telefone"></div>
            <div class="form-group"><label>Endere√ßo</label><input type="text" id="rest-endereco"></div>
            <h3>Administrador</h3>
            <div class="form-group"><label>Nome do Admin</label><input type="text" id="admin-nome" required></div>
            <div class="form-group"><label>Email do Admin</label><input type="email" id="admin-email" required></div>
            <div class="form-group"><label>Senha do Admin</label><input type="password" id="admin-senha" required></div>
            <div class="modal-actions">
                <button class="btn-primary" onclick="salvarRestaurante()">Salvar</button>
                <button class="btn-sm btn-sm-danger" onclick="fecharModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        async function carregarRestaurantes() {
            try {
                const res = await fetch('/api/restaurantes');
                const data = await res.json();
                const tbody = document.getElementById('restaurantes-list');
                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty">Nenhum restaurante cadastrado.</td></tr>';
                    return;
                }
                tbody.innerHTML = data.map(r => `
                    <tr>
                        <td>#${r.id}</td>
                        <td>${r.nome}</td>
                        <td>${r.email}</td>
                        <td>${r.telefone || '‚Äî'}</td>
                        <td><a href="/qrcodes/${r.id}" class="btn-sm" target="_blank">üì± QR Codes</a></td>
                    </tr>
                `).join('');
            } catch {
                document.getElementById('restaurantes-list').innerHTML = '<tr><td colspan="5" class="empty">Erro ao carregar.</td></tr>';
            }
        }

        function abrirModal() { document.getElementById('modal-restaurante').classList.add('active'); }
        function fecharModal() { document.getElementById('modal-restaurante').classList.remove('active'); }

        async function salvarRestaurante() {
            const dados = {
                nome: document.getElementById('rest-nome').value,
                email: document.getElementById('rest-email').value,
                telefone: document.getElementById('rest-telefone').value || null,
                endereco: document.getElementById('rest-endereco').value || null,
                admin_nome: document.getElementById('admin-nome').value,
                admin_email: document.getElementById('admin-email').value,
                admin_senha: document.getElementById('admin-senha').value
            };
            if (!dados.nome || !dados.email || !dados.admin_nome || !dados.admin_email || !dados.admin_senha) {
                alert('Preencha todos os campos obrigat√≥rios.');
                return;
            }
            try {
                const res = await fetch('/api/restaurantes', {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify(dados)
                });
                const result = await res.json();
                if (result.success) {
                    fecharModal();
                    carregarRestaurantes();
                } else {
                    alert('Erro: ' + result.error);
                }
            } catch {
                alert('Erro de conex√£o.');
            }
        }

        carregarRestaurantes();
    </script>
</body>
</html>